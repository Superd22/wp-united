<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
  <header>
    <license>http://www.gnu.org/licenses/gpl-2.0.html GNU General Public License v2</license>
    <title lang="en-gb">WP-UNITED WordPress - phpBB Integration Mod</title>
    <description lang="en-gb">Tightly integrates phpBB3 and WordPress.</description>
    <author-notes lang="en-gb">Make sure you follow the instructions in the DIY INSTRUCTIONS section, in order for this MOD to work properly!
Visit http://www.wp-united.com for more help or information.
</author-notes>
    <author-group>
      <author>
        <realname>John Wells</realname>
        <email>admin@wp-united.com</email>
        <username>Jhong</username>
        <homepage>www.wp-united.com</homepage>
        <contributions />
      </author>
    </author-group>
    <mod-version>0.8.0RC2</mod-version>
    <installation>
      <level>intermediate</level>
      <time>1200</time>
      <target-version>3.0.5</target-version>
    </installation>
    <link-group>
	<link type="template" href="templates/subsilver2.xml" lang="en">subsilver2</link>
	<link type="language" href="languages/de.xml" lang="de">Deutsch</link>
	<link type="language" href="languages/es.xml" lang="es">Espanol</link>
	<link type="language" href="languages/it.xml" lang="it">Italiano</link>
	<link type="contrib" href="contrib/convert_from_phpbb2/convert_from_phpbb2.xml" lang="en">Convert from phpBB2</link>
	<link type="contrib" href="contrib/upgrading_from_v0.5.0_or_v0.5.1/upgrade.xml" lang="en">Upgrading from WP-United v0.5.0 or v0.5.1</link>
	<link type="contrib" href="contrib/upgrading_from_v0.5.5_or_later/upgrade.xml" lang="en">Upgrading from WP-United v0.5.5 or later</link>
  </link-group>
  </header>

  <action-group>
    <copy>
      <file from="/root/blog.php" to="/blog.php" />
      <file from="/root/adm/style/acp_wp_united.html" to="/adm/style/acp_wp_united.html" />
      <file from="/root/includes/hooks/hook_wp-united.php" to="/includes/hooks/hook_wp-united.php" />
      <file from="/root/includes/acp/acp_wp_united.php" to="/includes/acp/acp_wp_united.php" />
      <file from="/root/includes/acp/info/acp_wp_united.php" to="/includes/acp/info/acp_wp_united.php" />
      <file from="/root/language/en/mods/admin_wp-united.php" to="/language/en/mods/admin_wp-united.php" />
      <file from="/root/language/en/mods/permissions_wp-united.php" to="/language/en/mods/permissions_wp-united.php" />
      <file from="/root/language/en/mods/wp-united.php" to="/language/en/mods/wp-united.php" />
      <file from="/root/styles/prosilver/template/blog.html" to="/styles/prosilver/template/blog.html" />
      <file from="/root/styles/subsilver2/template/blog.html" to="/styles/subsilver2/template/blog.html" />
      <file from="/root/wp-united/" to="/wp-united/" />
    </copy>
	<open src="includes/functions_content.php">
      <edit>
        <find>function make_clickable($text, $server_url = false, $class = 'postlink')
{
</find>
        <action type="before-add">if (!function_exists('make_clickable'))
{
</action>
      </edit>
      <edit>
        <find>	if ($server_url === false)
	{
</find>
        <action type="before-add">
	global $IN_WORDPRESS;
	if ($IN_WORDPRESS)
	{
		return wp_make_clickable($text); //WP version
	} else {//phpBB version 
</action>
      </edit>
      <edit>
        <find>	return preg_replace($magic_url_match, $magic_url_replace, $text);
}
</find>
        <action type="after-add">	}
}
</action>
      </edit>
</open>




<open src="includes/functions.php">


      <edit>
        <find><![CDATA[	// Which timezone?
	$tz = ($user->data['user_id'] != ANONYMOUS) ? strval(doubleval($user->data['user_timezone'])) : strval(doubleval($config['board_timezone']));
]]></find>
        <action type="after-add"><![CDATA[
	require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
	$GLOBALS['wpu_actions']->do_head($template);
]]></action>
      </edit>
    </open>
    <open src="memberlist.php">
      <edit>
        <find>		if (!empty($profile_fields['row']))
		{</find>
        <action type="before-add"><![CDATA[		require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
		$GLOBALS['wpu_actions']->generate_profile_link($member['user_wpublog_id'], $template);]]></action>
      </edit>
    </open>
    <open src="viewtopic.php">
      <edit>
        <find><![CDATA[}
$db->sql_freeresult($result);

// Load custom profile fields
if ($config['load_cpf_viewtopic'])]]></find>
        <action type="before-add"><![CDATA[	require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
	$GLOBALS['wpu_actions']->generate_viewtopic_link($row['user_wpublog_id'], $user_cache[$poster_id]);
	]]></action>
      </edit>
      <edit>
        <find><![CDATA[	// Dump vars into template
	$template->assign_block_vars('postrow', $postrow);	]]></find>
        <action type="before-add"><![CDATA[	$GLOBALS['wpu_actions']->show_viewtopic_link($user_cache[$poster_id], $postrow);
]]></action>
        <comment lang="en-gb">	</comment>
      </edit>
    </open>
    <open src="ucp.php">
      <edit>
        <find><![CDATA[		$message = $message . '<br /><br />' . sprintf($user->lang['RETURN_INDEX'], '<a href="' . append_sid("{$phpbb_root_path}index.$phpEx") . '">', '</a> ');]]></find>
        <action type="after-add"><![CDATA[		require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
		$GLOBALS['wpu_actions']->do_logout();	]]></action>
      </edit>
    </open>
    <open src="includes/ucp/ucp_profile.php">
      <edit>
        <find>						$message = 'PROFILE_UPDATED';</find>
        <action type="after-add"><![CDATA[						require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
						$GLOBALS['wpu_actions']->profile_update('reg_details', $user->data['user_id'], $user->data['user_wpuint_id'], $sql_ary);]]></action>
      </edit>
      <edit>
        <find>						// Update Custom Fields
						if (sizeof($cp_data))</find>
        <action type="before-add"><![CDATA[						require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
						$GLOBALS['wpu_actions']->profile_update('profile_info', $user->data['user_id'], $user->data['user_wpuint_id'], $sql_ary);]]></action>
      </edit>
    </open>
    <open src="includes/functions_user.php">
      <edit>
        <find><![CDATA[			if (isset($sql_ary['user_avatar']))
			{
				$userdata = ($custom_userdata === false) ? $user->data : $custom_userdata;]]></find>
        <action type="before-add"><![CDATA[			require_once($GLOBALS['phpbb_root_path'] . 'wp-united/wpu-actions.' . $GLOBALS['phpEx']);
			$GLOBALS['wpu_actions']->profile_update('avatar', ($custom_userdata === false) ? $user->data['user_id'] : $custom_userdata['user_id'], ($custom_userdata === false) ? $user->data['user_wpuint_id'] : $custom_userdata['user_wpuint_id'], $sql_ary);
						]]></action>
      </edit>
    </open>
    <open src="includes/acp/acp_users.php">
      <edit>
        <find>						add_log('admin', 'LOG_USER_USER_UPDATE', $data['username']);	</find>
        <action type="before-add"><![CDATA[						require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
						$GLOBALS['wpu_actions']->profile_update('reg_details', $user_id, $user_row['user_wpuint_id'], $sql_ary);
]]></action>
      </edit>
      <edit>
        <find>						// Update Custom Fields
						if (sizeof($cp_data))</find>
        <action type="before-add"><![CDATA[						require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
						$GLOBALS['wpu_actions']->profile_update('profile_info', $user_id, $user_row['user_wpuint_id'], $sql_ary);									]]></action>
      </edit>
    </open>
    <open src="style.php">
      <edit>
        <find><![CDATA[	echo $theme['theme_data']; ]]></find>
        <action type="before-add"><![CDATA[ 	require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
	$theme['theme_data'] = $GLOBALS['wpu_actions']->css_magic($theme['theme_data']); ]]></action>
      </edit>
    </open>
    <open src="language/en/common.php">
      <edit>
        <find><![CDATA[	'YOU_NO_NEW_PM'		=> 'No new private messages are waiting for you.',]]></find>
        <action type="after-add"><![CDATA[
	//WP-United
	'BLOG'			=> 	'WordPress Blog',
	'VISIT_BLOG'		=>	'Visit User\'s Blog',
	'ACP_WP_UNITED' 	=> 	'WP-United',
	'ACP_WPU_MAINPAGE'	=>	'WP-United Administration',
	'ACP_WPU_CATMAIN'	=> 	'WP-United Admin',
	'ACP_WPU_CATSETUP'	=>	'Set Up WP-United',
	'ACP_WPU_CATMANAGE'	=>	'Manage User Integration',
	'ACP_WPU_CATSUPPORT'	=>	'Support WP-United',
	'ACP_WPU_CATOTHER'	=>	'Other',
	'ACP_WPU_MAINTITLE'	=>	'Main Page',
	'ACP_WPU_DETAILED'	=>	'All Settings On A Page',
	'ACP_WPU_WIZARD'	=> 	'Setup Wizard',
	'ACP_WPU_USERMAP'	=> 	'User Integration Mapping Tool',
	'ACP_WPU_PERMISSIONS'	=> 	'Administer permissions',		
	'ACP_WPU_DONATE'	=> 	'Donate to WP-United',
	'ACP_WPU_UNINSTALL'	=> 	'Uninstall WP-United',
	'ACP_WPU_RESET'		=> 	'Reset WP-United',
	'ACP_WPU_DEBUG'		=>	'Debug Info to Post',	
	'WP_UNINSTALLED' 	=> 	'Uninstalled WP-United',
	'WP_INSTALLED' 		=> 	'Installed WP-United',
]]></action>
      </edit>
    </open>
    <open src="styles/prosilver/template/overall_header.html">
      <edit>
        <find><![CDATA[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">]]></find>
        <action type="replace-with"><![CDATA[<!-- IF WP_DTD -->{WP_DTD}<!-- ELSE --><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><!-- ENDIF -->]]></action>
      </edit>
      <edit>
        <find><![CDATA[<title>{SITENAME} &bull; <!-- IF S_IN_MCP -->{L_MCP} &bull; <!-- ELSEIF S_IN_UCP -->{L_UCP} &bull; <!-- ENDIF -->{PAGE_TITLE}</title>]]></find>
        <action type="after-add"><![CDATA[<!-- IF PHPBB_BASE --><base href="{PHPBB_BASE}" /><!-- ENDIF -->
]]></action>
      </edit>
      <edit>
        <find><![CDATA[<script type="text/javascript">
]]></find>
        <action type="before-add"><![CDATA[<!-- IF WP_HEADERINFO_EARLY -->{WP_HEADERINFO_EARLY}<!-- ENDIF -->
]]></action>
      </edit>
      <edit>
        <find><![CDATA[</head>]]></find>
        <action type="before-add"><![CDATA[<!-- IF WP_HEADERINFO_LATE -->{WP_HEADERINFO_LATE}<!-- ENDIF -->
]]></action>
      </edit>
      <edit>
        <find><![CDATA[<li class="icon-faq"><a href="{U_FAQ}" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>]]></find>
		<action type="after-add"><![CDATA[<!-- IF S_BLOG --><li class="icon-members"><a href="{U_BLOG}" title="{L_BLOG}">{L_BLOG}</a></li><!-- ENDIF -->]]></action>
	 </edit>
	 </open>
	  <open src="styles/prosilver/template/overall_footer.html">
	  <edit>
        <find><![CDATA[		<!-- IF TRANSLATION_INFO --><br />{TRANSLATION_INFO}<!-- ENDIF -->]]></find>
        <action type="after-add"><![CDATA[		<!-- IF WP_CREDIT --><br />{WP_CREDIT}<!-- ENDIF -->		]]></action>
      </edit>
    </open>
    <open src="styles/prosilver/template/memberlist_view.html">
      <edit>
        <find><![CDATA[			<dt>{postrow.PROFILE_FIELD1_NAME}:</dt> <dd>{postrow.PROFILE_FIELD1_VALUE}</dd>
		<!-- ENDIF -->]]></find>
        <action type="after-add"><![CDATA[		<!-- IF U_BLOG_LINK -->
			<dt>{L_BLOG}:</dt> <dd><a href="{U_BLOG_LINK}" title="{L_VISIT_BLOG}" >{L_VISIT_BLOG}</a></dd>
		<!-- ENDIF -->]]></action>
      </edit>
    </open>
    <open src="styles/prosilver/template/viewtopic_body.html">
      <edit>
        <find><![CDATA[			<dd><strong>{postrow.PROFILE_FIELD1_NAME}:</strong> {postrow.PROFILE_FIELD1_VALUE}</dd>
		<!-- ENDIF -->]]></find>
        <action type="after-add"><![CDATA[		<!-- IF postrow.U_BLOG_LINK -->
			<dd><strong>{L_BLOG}:</strong> <a href="{postrow.U_BLOG_LINK}" title="{L_VISIT_BLOG}" >{L_VISIT_BLOG}</a></dd>
		<!-- ENDIF -->]]></action>
      </edit>
    </open>
    <open src="styles/prosilver/theme/common.css">
      <edit>
        <find>
h1 {
	/* Forum name */
</find>
        <action type="replace-with">
h1, #page-header h1 {
	/* Forum name */
	padding: 0;
	text-align: left;	</action>
        <comment lang="en-gb">	You only need to make this alteration if you will be using template integration. It is for compatibility with the default WordPress template.</comment>
      </edit>
      <edit>
        <find>#site-description {</find>
        <action type="after-add">	text-align: left;
</action>
        <comment lang="en-gb">	You only need to make this alteration if you will be using template integration. It is for compatibility with the default WordPress template.</comment>
      </edit>
    </open>    
    <diy-instructions lang="en-gb"><![CDATA[	

THEME CHANGES
-------------
If you need to install the template modifications for the subSilver2 template, use the subsilver2.xml file in the templates folder.

if you are using another theme based on prosilver, make the above prosilver changes to your theme now.

Remember to purge the phpBB template cache, and refresh your themes after making these changes.

IMPORTANT NEXT STEPS
--------------------

After making all the edits, you must complete the following steps:

1. Run the wpu-install.php script that you copied to your phpBB root folder, by accessing http://your-site-toot/wpu-install.php. When done, delete wpu-install.php.

2. Make sure you have installed WordPress. If you need help, look at the instructions on the WordPress Codex, here: http://codex.wordpress.org/Installing_WordPress

3. IMPORTANT: Copy the file wpu-plugin.php from your phpbb-root/wp-united folder to your WordPress plugins folder (wp-includes/plugins). (This was not required in older versions of WP-United)

4. Run the Setup Wizard, under the WP-United tab that will appear in your ACP.

For more detailed instructions, please visit http://www.wp-united.com

REPORTING BUGS / GETTING HELP
-----------------------------

Please remember, 95% of reported bugs are user error. If you encounter any problems, re-read the above steps carefully, and make sure you have done everything as instructed, and try installing the mod using AutoMod. 

Check that your phpBB server settings (especially "script path") and WordPress settings are correct, then try re-running the WP-United install wizard (WP-United tab in the phpBB Admin Control Panel).

If it still fails, please:
(1) If you are getting blank pages, turn on PHP error reporting or look in your server log to find the underlying cause of the problem. We can't respond to any support requests referring to "blank pages" without accompanying error output.
(2) Use "Debug Info To Post" function, located under the WP-United Admin Control Panel tab, to getrelevant debug information.

Post this information, together with full details of any error, and what you did to generate the error, on http://www.wp-united.com , after performing a search for similar issues.
]]></diy-instructions>
  </action-group>
</mod>
