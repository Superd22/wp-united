<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.3.xsd">
  <header>
    <license>http://www.gnu.org/licenses/gpl-2.0.html GNU General Public License v2</license>
    <title lang="en-gb">WP-United: Upgrade from v0.8.x</title>
    <description lang="en-gb">Tightly integrates phpBB3 and WordPress.</description>
    <author-notes lang="en-gb">Make sure you follow the instructions in the DIY INSTRUCTIONS section, in order for this MOD to work properly!
Visit http://www.wp-united.com for more help or information.
</author-notes>
    <author-group>
      <author>
        <realname>John Wells</realname>
        <email>admin@wp-united.com</email>
        <username>Jhong</username>
        <homepage>www.wp-united.com</homepage>
        <contributions />
      </author>
    </author-group>
    <mod-version>0.9.0RC3</mod-version>
    <installation>
      <level>intermediate</level>
      <time>912</time>
      <target-version>3.0.7</target-version>
    </installation>
  <link-group>
	<link type="parent" href="../../install.xml" lang="en">Main install file</link>
	<link type="template" href="templates/subsilver2.xml" lang="en">subsilver2</link>
	<link type="contrib" href="contrib/upgrading_from_v0.8.0_or_later/upgrade.xml" lang="en">Upgrading from WP-United v0.8.0 or later</link>
	<link type="contrib" href="contrib/upgrading_from_v0.5.5_v0.6x_or_v0.7x/upgrade.xml" lang="en">Upgrading from WP-United v0.5.5, v0.6x or v0.7x</link>
	<link type="contrib" href="contrib/upgrading_from_v0.5.0_or_v0.5.1/upgrade.xml" lang="en">Upgrading from WP-United v0.5.0 or v0.5.1</link>	
  </link-group>
  </header>
  
  <action-group>
      <diy-instructions lang="en-gb"><![CDATA[When copying, don't forget to overwrite your old blog.php, remembering that you may have moved or renamed it to a different location. After doing so, open it and provide the path back to phpBB where indicated.

Following this, visit your phpBB Admin Control Panel, and purge your phpBB cache.  

Then, run the WP-United Setup Wizard all the way through.

]]></diy-instructions>
    <copy>
      <file from="/root/blog.php" to="/blog.php" />
      <file from="/root/adm/style/acp_wp_united.html" to="/adm/style/acp_wp_united.html" />
      <file from="/root/includes/hooks/hook_wp-united.php" to="/includes/hooks/hook_wp-united.php" />
      <file from="/root/includes/acp/acp_wp_united.php" to="/includes/acp/acp_wp_united.php" />
      <file from="/root/includes/acp/info/acp_wp_united.php" to="/includes/acp/info/acp_wp_united.php" />
      <file from="/root/language/en/mods/admin_wp-united.php" to="/language/en/mods/admin_wp-united.php" />
      <file from="/root/language/en/mods/permissions_wp-united.php" to="/language/en/mods/permissions_wp-united.php" />
      <file from="/root/language/en/mods/wp-united.php" to="/language/en/mods/wp-united.php" />
      <file from="/root/styles/prosilver/template/blog.html" to="/styles/prosilver/template/blog.html" />
      <file from="/root/wp-united/" to="/wp-united/" />
    </copy>
    
    <open src="includes/functions_user.php">
      <edit>
		<find><![CDATA[function validate_username($username, $allowed_username = false)]]></find>
		<action type="replace-with"><![CDATA[if(!function_exists('validate_username') && (!defined('WPU_BLOG_PAGE')))
{
	function validate_username($username, $allowed_username = false)
	{
		return phpbb_validate_username($username, $allowed_username);
	}
}
function phpbb_validate_username($username, $allowed_username = false)]]></action>

      </edit>
     </open>
     
						
		     <open src="includes/functions_content.php">
      <edit>
        <find><![CDATA[if (!function_exists('make_clickable'))
{
function make_clickable($text, $server_url = false, $class = 'postlink')
{

	global $IN_WORDPRESS;
	if ($IN_WORDPRESS)
	{
		return wp_make_clickable($text); //WP version
	} else {//phpBB version]]></find>
	 <action type="replace-with"><![CDATA[if (!function_exists('make_clickable'))
{
	function make_clickable($text, $server_url = false, $class = 'postlink') 
	{
		return phpbb_make_clickable($text, $server_url, $class);
	}
}
function phpbb_make_clickable($text, $server_url = false, $class = 'postlink')
{]]></action>
</edit>
<edit>
<find><![CDATA[	return preg_replace($magic_url_match, $magic_url_replace, $text);
}
	}
}]]></find>
<action type="replace-with"><![CDATA[	return preg_replace($magic_url_match, $magic_url_replace, $text);
}]]></action>
</edit>
</open> 

<open src="includes/acp/acp_main.php">
  <edit>
	<find><![CDATA[						require_once($phpbb_root_path . 'wp-united/cache.' . $phpEx);
					$wpuCache = WPU_Cache::getInstance();
					$wpuCache->purge();]]></find>
	<action type="replace-with"><![CDATA[						require_once($phpbb_root_path . 'wp-united/wpu-actions.' . $phpEx);
					$GLOBALS['wpu_actions']->purge_cache();]]></action>
  </edit>
</open>
    
    
    
      </action-group>
</mod>
